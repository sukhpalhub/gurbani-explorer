<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ title }}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/static/bulma.min.css">
    <link rel="stylesheet" href="/static/style.css">
    <style>
    body {
        {% if theme == "dark" %}
            color: white;
        {% else %}
            color: black;
        {% endif %}

        /* rgba background with opacity */
        background-color: rgba(
            {{ background_color_rgb.r }},
            {{ background_color_rgb.g }},
            {{ background_color_rgb.b }},
            {{ background_opacity }}
        );

        font-size: {{ font_size }};
    }
</style>


    <script>
        fetchData = async () => {
    const res = await fetch('/api/custom_data');
    const data = await res.json();

    const gurmukhiEl = document.getElementById('gurmukhi');
    const punjabiEl = document.getElementById('punjabi');
    const englishEl = document.getElementById('english');

    gurmukhiEl.textContent = data.gurmukhi;
    punjabiEl.textContent = data.punjabi;
    englishEl.textContent = data.english;

    gurmukhiEl.style.fontFamily = data.font;
    punjabiEl.style.fontFamily = data.font;

    document.body.style.backgroundColor = `rgba(${data.background_color_rgb.r}, ${data.background_color_rgb.g}, ${data.background_color_rgb.b}, ${data.background_opacity})`;
    document.body.style.fontSize = data.font_size;
    document.body.className = data.theme;

    const pElems = document.querySelectorAll('.top-aligned-container p');
    pElems.forEach(p => {
        p.style.marginBottom = data.font_gap;
        fitTextToOneLine(p, parseInt(data.font_size)); // Pass max font size in px (strip "px")
    });

    setTimeout(fetchData, 1000);
};

        fetchData();

        function fitTextToOneLine(element, maxFontSizePx) {
    const parentWidth = element.parentElement.clientWidth;
    let fontSize = maxFontSizePx;
    element.style.whiteSpace = 'nowrap';
    element.style.fontSize = fontSize + 'px';

    // Reduce font size until text fits or minimum size reached
    while (element.scrollWidth > parentWidth && fontSize > 8) { // 8px min font size
        fontSize -= 1;
        element.style.fontSize = fontSize + 'px';
    }
}

        </script>

</head>
<body>
    <section class="top-aligned-container">
        <p class="gurmukhi-1" id="gurmukhi">{{ gurmukhi }}</p>
        <p class="" id="punjabi">{{ punjabi }}</p>
        <p class="" id="english">{{ english }}</p>
    </section>
</body>
</html>
